=============================================================================
WIRING DIAGRAM - IoT Security Motion Detection System
=============================================================================

OPTION A: ESP32 (Recommended)
-----------------------------------------------------------------------------

┌─────────────────────────────────────────────────────────────────────┐
│                           ESP32 DevKit                               │
│                                                                      │
│   3.3V ●────────────────────┐                                       │
│                             │                                       │
│   GND  ●────────────────────┼──────────────┐                        │
│                             │              │                        │
│   GPIO27 ●──────────────────┼──────────┐   │                        │
│                             │          │   │                        │
│   GPIO26 ●──────────────────┼───┐      │   │                        │
│                             │   │      │   │                        │
│   (USB) ●                   │   │      │   │                        │
└─────────────────────────────┼───┼──────┼───┼────────────────────────┘
                              │   │      │   │
                              │   │      │   │
                    ┌─────────┘   │      │   └──────────┐
                    │             │      │              │
                    ▼             ▼      ▼              ▼
          ┌──────────────┐   ┌──────────────┐   ┌──────────────┐
          │ PIR HC-SR501 │   │ Relay Module │   │   Alarm/     │
          │              │   │              │   │   Speaker    │
          │  VCC ●───────┼───┘              │   │              │
          │  GND ●───────┼──────────────────┼───┘              │
          │  OUT ●───────┼──────────────────┘                  │
          │              │   │  VCC ●                           │
          └──────────────┘   │  GND ●                           │
                             │  IN  ●                           │
                             │  COM ●──────┐                    │
                             │  NO  ●──────┼────────────────────┘
                             └──────────────┘

CONNECTIONS:
  PIR Sensor:
    - VCC (PIR) → 3.3V (ESP32)
    - GND (PIR) → GND (ESP32)
    - OUT (PIR) → GPIO27 (ESP32)
  
  Relay Module:
    - VCC (Relay) → 3.3V (ESP32) *hoặc 5V nếu relay cần*
    - GND (Relay) → GND (ESP32)
    - IN (Relay) → GPIO26 (ESP32)
    - COM (Relay) → (+) Alarm/Speaker
    - NO (Relay) → (-) Alarm/Speaker

NOTES:
  - Một số relay module cần 5V → dùng VIN pin thay vì 3.3V
  - Đảm bảo common ground (tất cả GND nối chung)
  - PIR sensor cần 30s để ổn định sau khi bật nguồn

=============================================================================

OPTION B: Arduino Uno (Serial Mode)
-----------------------------------------------------------------------------

┌─────────────────────────────────────────────────────────────────────┐
│                         Arduino Uno                                  │
│                                                                      │
│   5V   ●────────────────────┐                                       │
│                             │                                       │
│   GND  ●────────────────────┼──────────────┐                        │
│                             │              │                        │
│   D7   ●────────────────────┼──────────┐   │                        │
│                             │          │   │                        │
│   D8   ●────────────────────┼───┐      │   │                        │
│                             │   │      │   │                        │
│   (USB)●───> To PC          │   │      │   │                        │
└─────────────────────────────┼───┼──────┼───┼────────────────────────┘
                              │   │      │   │
                              │   │      │   │
                    ┌─────────┘   │      │   └──────────┐
                    │             │      │              │
                    ▼             ▼      ▼              ▼
          ┌──────────────┐   ┌──────────────┐   ┌──────────────┐
          │ PIR HC-SR501 │   │ Relay Module │   │   Alarm/     │
          │              │   │              │   │   Speaker    │
          │  VCC ●───────┼───┘              │   │              │
          │  GND ●───────┼──────────────────┼───┘              │
          │  OUT ●───────┼──────────────────┘                  │
          │              │   │  VCC ●                           │
          └──────────────┘   │  GND ●                           │
                             │  IN  ●                           │
                             │  COM ●──────┐                    │
                             │  NO  ●──────┼────────────────────┘
                             └──────────────┘

CONNECTIONS:
  PIR Sensor:
    - VCC (PIR) → 5V (Arduino)
    - GND (PIR) → GND (Arduino)
    - OUT (PIR) → D7 (Arduino)
  
  Relay Module:
    - VCC (Relay) → 5V (Arduino)
    - GND (Relay) → GND (Arduino)
    - IN (Relay) → D8 (Arduino)
    - COM (Relay) → (+) Alarm/Speaker
    - NO (Relay) → (-) Alarm/Speaker
  
  USB Connection:
    - Arduino USB → PC (chạy Serial Bridge script)

NOTES:
  - Arduino cần kết nối PC qua USB để chạy Serial Bridge
  - Cần chạy script: python backend/services/serial_bridge.py --port COM3

=============================================================================

BREADBOARD LAYOUT (ESP32 Example)
-----------------------------------------------------------------------------

                        Breadboard
     ┌───────────────────────────────────────────────────┐
     │                                                   │
     │  (+) Rail ─────────────────────────────────       │
     │                                                   │
     │  PIR     ┌───┐  ┌───┐  ┌───┐                     │
     │  [VCC]───┤ • ├──┤ • ├──┤ • │ (to 3.3V)           │
     │  [GND]───┤ • ├──┤ • ├──┤ • │ (to GND)            │
     │  [OUT]───┤ • ├──┤ • ├──┤ • │ (to GPIO27)         │
     │          └───┘  └───┘  └───┘                     │
     │                                                   │
     │  Relay   ┌───┐  ┌───┐  ┌───┐                     │
     │  [VCC]───┤ • ├──┤ • ├──┤ • │ (to 3.3V/5V)        │
     │  [GND]───┤ • ├──┤ • ├──┤ • │ (to GND)            │
     │  [IN ]───┤ • ├──┤ • ├──┤ • │ (to GPIO26)         │
     │          └───┘  └───┘  └───┘                     │
     │                                                   │
     │  (-) Rail ─────────────────────────────────       │
     │                                                   │
     └───────────────────────────────────────────────────┘

=============================================================================

POWER REQUIREMENTS
-----------------------------------------------------------------------------

Component         | Voltage | Current  | Notes
------------------|---------|----------|----------------------------------
PIR HC-SR501      | 3.3-5V  | 65µA     | Auto-detects voltage
ESP32             | 3.3V    | 240mA    | Via USB or external 5V
Arduino Uno       | 5V      | 50mA     | Via USB or external 7-12V
Relay Module      | 3.3-5V  | 70mA     | Check module specs
Alarm/Speaker     | varies  | varies   | Use relay as switch only

Total Power Consumption (ESP32 setup):
  - Idle: ~300mA @ 3.3V
  - Active (motion + alarm): ~400mA @ 3.3V
  - Recommended power supply: 5V 1A USB adapter

=============================================================================

TROUBLESHOOTING
-----------------------------------------------------------------------------

PIR Sensor không hoạt động:
  ✓ Kiểm tra VCC/GND đúng cực
  ✓ Đợi 30s sau khi cấp nguồn (PIR cần warm-up)
  ✓ Điều chỉnh 2 potentiometer trên PIR:
    - Sensitivity (độ nhạy)
    - Delay time (thời gian giữ output HIGH)

Relay không bật:
  ✓ Kiểm tra relay cần 5V hay 3.3V
  ✓ Đảm bảo GND chung
  ✓ Kiểm tra LED trên relay module (nếu có)
  ✓ Test bằng code: digitalWrite(RELAY_PIN, HIGH)

ESP32/Arduino reset liên tục:
  ✓ Nguồn cung cấp không đủ dòng
  ✓ Dùng nguồn ngoài thay vì USB
  ✓ Tháo relay và test lại

=============================================================================

SAFETY WARNINGS
-----------------------------------------------------------------------------

⚠️  CẢNH BÁO AN TOÀN:
  - KHÔNG nối relay trực tiếp với 220V AC nếu chưa có kinh nghiệm
  - Dùng adapter 5V DC cho alarm/speaker
  - Đảm bảo cách điện tốt cho tất cả kết nối
  - Ngắt nguồn trước khi thay đổi wiring
  - Kiểm tra kỹ trước khi cấp nguồn lần đầu

=============================================================================

Generated: January 6, 2026
Version: 1.0
